---
title: Gitlab
tags:
  - sgd
---

# Gitlab

**官方文档**([GitLab Docs | GitLab](https://docs.gitlab.com/ee/))

**Linux 服务器**： 安装Gitlab https://about.gitlab.com/

**Window /Linux服务器：**安装Gitlab runner(https://docs.gitlab.com/runner/), powershell(系统自带), pyinstaller(https://www.pyinstaller.org/打包python使用)，[Git(https://git-scm.com/](https://git-scm.com/)与Git lab交互拉取，推送代码).

## 安装Gitlab

### 从Linux Package安装

[Download and install GitLab | GitLab](https://about.gitlab.com/install/)

以CentOS为例

```bash
# 可选：在系统防火墙中打开 HTTP、HTTPS 和 SSH 访问
sudo yum install -y curl policycoreutils-python openssh-server perl
# Enable OpenSSH server daemon if not enabled: sudo systemctl status sshd
sudo systemctl enable sshd
sudo systemctl start sshd

# Check if opening the firewall is needed with: sudo systemctl status firewalld
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo systemctl reload firewalld
```

```bash
# 可选：安装 Postfix 以发送通知电子邮件
sudo yum install postfix
sudo systemctl enable postfix
sudo systemctl start postfix
```

```shell
## 添加 GitLab 包存储库
curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash

## 安装Gitlab-ce（社区版）,ee(商业版)
sudo yum install -y gitlab-ce
```

```shell
# 备用选项:访问不通可更换镜像源，新建文件/etc/yum.repos.d/gitlab-ce.repo
# 或者直接下载rpm包，https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/
[gitlab-ce]
name=Gitlab CE Repository
baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/
gpgcheck=0
enabled=1 

# 然后执行安装
sudo yum makecache
sudo yum install -y gitlab-ce
```

### 从Docker安装

```shell
# 配置一个新的环境变量
export GITLAB_HOME=/srv/gitlab

# 使用 Docker 引擎安装 GitLab
sudo docker run --detach \
  --hostname gitlab.example.com \
  --publish 443:443 --publish 80:80 --publish 22:22 \
  --name gitlab \
  --restart always \
  --volume $GITLAB_HOME/config:/etc/gitlab \
  --volume $GITLAB_HOME/logs:/var/log/gitlab \
  --volume $GITLAB_HOME/data:/var/opt/gitlab \
  gitlab/gitlab-ce:latest
  
# 使用以下命令中的用户名和密码登录：root
sudo docker exec -it gitlab grep 'Password:' /etc/gitlab/initial_root_password
```



## 管理Gitlab

```shell
 # 查看gitlab版本
 head -1 /opt/gitlab/version-manifest.txt
 # 查看gitlab运行状态
 sudo gitlab-ctl status
```

用vim打开gitlab的配置文件：`vim /etc/gitlab/gitlab.rb`

完成配置后，执行 `gitlab-ctl reconfigure` 使配置生效。

1. 修改URL和系统端口：

   `external_url 'http://127.0.0.1'`
   改为：`external_url 'http://<服务器地址或域名>:<端口>'`

   > 连接wifi后获取服务器地址为10.55.3.117，external_url设置为`'http://10.55.3.117'`后，连同一WiFi设备（即同一局域网下）可访问gitlab。

​	2.修改GitLab头像Gravatar源

```shell
vim /etc/gitlab/gitlab.rb
gitlab_rails['gravatar_plain_url'] = 'http://sdn.geekzu.org/avatar/%{hash}?s=%{size}&d=identicon'  
gitlab_rails['gravatar_ssl_url'] = 'http://sdn.geekzu.org/avatar/%{hash}?s=%{size}&d=identicon' 
```

​	3.浏览管理页面并登录

浏览器访问本机地址`'http://127.0.0.1'`或者自定义的域名`'http://10.55.3.117'`

密码将在安装过程随机生成并存储 24 小时。用户名`root` 密码`/etc/gitlab/initial_root_password`

	4. 重置用户密码

```shell
sudo gitlab-rake "gitlab:password:reset"
# GitLab 要求输入用户名、密码和密码确认。（8位以上，可直接重置管理员密码,已修改为rootroot）
```

​	5.选择语言
setting ----preferences----Localization---简体中文



## 安装Gitlab Runner

待续

