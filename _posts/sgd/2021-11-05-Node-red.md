---
title: Node-red
tags:
  - sgd
---

# Node-red[ğŸ”—](https://nodered.org/)

Node-RED æ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºçš„ä½ä»£ç ç¼–ç¨‹å·¥å…·ï¼Œç”¨äºä»¥æ–°é¢–æœ‰è¶£çš„æ–¹å¼å°†ç¡¬ä»¶è®¾å¤‡ã€API å’Œåœ¨çº¿æœåŠ¡è¿æ¥åœ¨ä¸€èµ·ã€‚

## ç‰¹ç‚¹

- æä¾›äº†ä¸€ä¸ª**åŸºäºæµè§ˆå™¨çš„æµç¼–è¾‘å™¨**ï¼Œå¯ä»¥ä½¿ç”¨é¢æ¿ä¸­çš„å¹¿æ³›èŠ‚ç‚¹è½»æ¾å°†æµè¿æ¥åœ¨ä¸€èµ·ï¼Œåªéœ€å•å‡»å³å¯éƒ¨ç½²è¿è¡Œã€‚
- åŒ…å­˜å‚¨åº“ä¸­æœ‰è¶…è¿‡ 225,000 ä¸ªæ¨¡å—ï¼ŒåŒæ—¶å¯ä»¥åœ¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­åˆ›å»º **JavaScript å‡½æ•°**ã€‚
- è½»é‡çº§è¿è¡Œæ—¶**å»ºç«‹åœ¨ Node.js ä¹‹ä¸Š**ï¼Œå……åˆ†åˆ©ç”¨äº†å…¶äº‹ä»¶é©±åŠ¨çš„éé˜»å¡æ¨¡å‹ã€‚è¿™ä½¿å…¶éå¸¸é€‚åˆåœ¨ Raspberry Pi ç­‰ä½æˆæœ¬ç¡¬ä»¶ä»¥åŠäº‘ä¸­è¿è¡Œåœ¨ç½‘ç»œè¾¹ç¼˜ã€‚

## å¿«é€Ÿå¼€å§‹

#### åœ¨æœ¬åœ°è¿è¡Œ

ç³»ç»Ÿç¯å¢ƒï¼šubuntu

å…ˆå†³æ¡ä»¶ï¼šNode.js

å®‰è£…å‘½ä»¤(è¯¥å‘½ä»¤ä¼šå°† Node-RED å®‰è£…ä¸ºå…¨å±€æ¨¡å—åŠå…¶ä¾èµ–é¡¹)

```shell
# ubuntuä¸‹ä½¿ç”¨npm
sudo npm install -g --unsafe-perm node-red
# window
npm install -g --unsafe-perm node-red
# è¿è¡Œï¼Œé€šè¿‡å°†æµè§ˆå™¨æŒ‡å‘http://localhost:1880æ¥è®¿é—® Node-RED ç¼–è¾‘å™¨ã€‚
node-red

# æ¨èï¼šä½¿ç”¨ docker å®‰è£…å¹¶è¿è¡Œ
docker run -it -p 1880:1880 --name mynodered nodered/node-red
```

#### åœ¨è®¾å¤‡ä¸Š

##### è®¾å¤‡ï¼šèƒ½æºæ§åˆ¶å™¨

ä½¿ç”¨dockeræ–¹å¼éƒ¨ç½²ï¼Œå¿«æ·æœ‰æ•ˆï¼Œéƒ¨ç½²ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒä¸€è‡´ã€‚

##### è®¾å¤‡ï¼šæ ‘è“æ´¾

æä¾›äº†ä¸€ä¸ªè„šæœ¬æ¥å°† Node.jsã€npm å’Œ Node-RED å®‰è£…åˆ° Raspberry Pi ä¸Š

```shell
bash <(curl -sL https://raw.githubusercontent.com/node-red/linux-installers/master/deb/update-nodejs-and-nodered)

# ç”±äº Raspberry Pi çš„å†…å­˜æœ‰é™ï¼Œä½¿ç”¨æ›¿ä»£å‘½ä»¤å¹¶ä¼ å…¥ max-old-space-sizeå‚æ•°ã€‚
node-red-pi --max-old-space-size=256

# å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable nodered.service
sudo systemctl disable nodered.service
```

å¦‚æœåœ¨æ ‘è“æ´¾æ¡Œé¢ä¸Šä½¿ç”¨æµè§ˆå™¨ï¼Œå¯ä»¥æ‰“å¼€åœ°å€ï¼š[http://localhost:1880](http://localhost:1880/)ã€‚

ä»å¦ä¸€å°æœºå™¨æµè§ˆæ—¶ï¼Œä½¿ç”¨ Pi çš„ä¸»æœºåæˆ– IP åœ°å€ï¼š`http://<hostname>:1880`ã€‚é€šè¿‡`hostname -I`æ‰¾åˆ° IP åœ°å€ã€‚

##### è®¾å¤‡ï¼šå®‰å“

ä½¿ç”¨åº”ç”¨å•†åº—ä¸­çš„[Termux](https://termux.com/)åº”ç”¨å¯ä»¥è½»æ¾åœ°åœ¨ Android è®¾å¤‡ä¸Šè¿è¡Œ Node-REDã€‚

#### åœ¨äº‘ç«¯

IBM cloudã€AWSã€å¾®è½¯ Azure

## åœ¨ Docker ä¸‹è¿è¡Œ

Node-RED å¯ä»¥åœ¨ Docker ä¸‹ä»¥å¤šç§æ–¹å¼è¿è¡Œï¼Œå¹¶ä¸”æ”¯æŒå¤šç§æ¶æ„ï¼ˆamd64ã€arm32v6ã€arm32v7ã€arm64v8 å’Œ s390xï¼‰ã€‚

### åŸºæœ¬å‘½ä»¤

Node-RED åœ¨[Docker Hub](https://hub.docker.com/r/nodered/node-red/)ä¸Šçš„å­˜å‚¨åº“ä¸º`nodered/node-red`.

```shell
# æ— éœ€çŸ¥é“/æŒ‡å®šç³»ç»Ÿæ¶æ„ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ‹‰å–åŒ¹é…çš„é•œåƒï¼Œå¹¶è¿è¡Œå®¹å™¨ã€‚
docker run -it -p 1880:1880 -v node_red_data:/data --name mynodered nodered/node-red:latest ï¼ˆå¤§å°500MBï¼‰
# æŒ‡å®šæ ‡ç­¾
docker run -it -p 1880:1880 -v node_red_data:/data --name mynodered nodered/node-red:1.3.5-12-arm32v7 ï¼ˆå¤§å°150MBï¼‰
docker run -it -p 1880:1880 -v node_red_data:/data --name mynodered nodered/node-red:1.3.5-12-minimal-arm32v7ï¼ˆæœ€å°ç‰ˆæœ¬ä¸åŒ…å«æ„å»ºå·¥å…·æˆ–å¯¹é¡¹ç›®çš„æ”¯æŒã€‚å¤§å°60MBï¼‰

# å…¶ä»–æ¶‰åŠå‘½ä»¤ä¸dockerä¸€è‡´
docker attach mynodered
docker start mynodered
docker stop mynodered
docker exec -it mynodered /bin/bash

## ç”¨æˆ·æ•°æ®ç®¡ç†
# ä½¿ç”¨ä¸»æœºç›®å½•è¿›è¡ŒæŒä¹…åŒ–ï¼ˆç»‘å®šæŒ‚è½½ï¼‰
docker run -it -p 1880:1880 -v /home/.node-red:/data --name mynodered nodered/node-red
# ä½¿ç”¨å‘½åæ•°æ®å·ï¼ˆå¯ä»¥é”€æ¯å®¹å™¨å¹¶å¯åŠ¨ä¸€ä¸ªæ–°å®ä¾‹ï¼Œè€Œä¸ä¼šä¸¢å¤±ç”¨æˆ·æ•°æ®ï¼‰
docker volume create --name node_red_data
docker volume ls
# åœ¨å®¹å™¨è¿è¡Œæ—¶ä»æŒ‚è½½çš„å·ä¸­å¤‡ä»½æ•°æ®
docker cp  mynodered:/data  /your/backup/directory

# æ›´æ–°å®¹å™¨
docker pull nodered/node-red
docker stop mynodered
docker rm mynodered
docker run -it -p 1880:1880 -v node_red_data:/data --name mynodered nodered/node-red
```

### é“¾æ¥å®¹å™¨

ä½¿ç”¨ Dockeræ¡¥æ¥ç½‘ç»œåœ¨â€œå†…éƒ¨â€é“¾æ¥å…¶ä»–å®¹å™¨ã€‚

```shell
# åˆ›å»ºä¸€ä¸ªåä¸ºiotçš„æ–°ç½‘æ¡¥
docker network create iot
# æ‰€æœ‰éœ€è¦é€šä¿¡çš„å®¹å™¨éƒ½éœ€è¦ä½¿ç”¨â€“networkå‘½ä»¤è¡Œé€‰é¡¹æ·»åŠ åˆ°åŒä¸€ä¸ªç½‘æ¡¥
docker run -itd --network iot --name mybroker eclipse-mosquitto mosquitto -c /mosquitto-no-auth.conf ï¼ˆEclipse Mosquitto æ˜¯ä¸€ä¸ªå¼€æºMQTTä»£ç†ï¼‰
docker run -itd -p 1880:1880 -v node_red_data:/data --network iot --name mynodered nodered/node-red ï¼ˆä½¿ç”¨ä¸»æœºåmybrokerä» Node-RED åº”ç”¨ç¨‹åºè®¿é—®ä»£ç†ï¼‰
```

ç®€å•æµç¨‹ï¼šæ˜¾ç¤ºè¿æ¥åˆ°ä»£ç†çš„ mqtt èŠ‚ç‚¹

```JSON
    [{"id":"c51cbf73.d90738","type":"mqtt in","z":"3fa278ec.8cbaf","name":"","topic":"test","broker":"5673f1d5.dd5f1","x":290,"y":240,"wires":[["7781c73.639b8b8"]]},{"id":"7008d6ef.b6ee38","type":"mqtt out","z":"3fa278ec.8cbaf","name":"","topic":"test","qos":"","retain":"","broker":"5673f1d5.dd5f1","x":517,"y":131,"wires":[]},{"id":"ef5b970c.7c864","type":"inject","z":"3fa278ec.8cbaf","name":"","repeat":"","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":290,"y":153,"wires":[["7008d6ef.b6ee38"]]},{"id":"7781c73.639b8b8","type":"debug","z":"3fa278ec.8cbaf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"auto","x":505,"y":257,"wires":[]},{"id":"5673f1d5.dd5f1","type":"mqtt-broker","z":"","name":"","broker":"mybroker","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeRetain":"false","closePayload":"","willTopic":"","willQos":"0","willRetain":"false","willPayload":""}]
```

### è®¿é—®è®¾å¤‡

è¦è®¿é—®ä¸»æœºä¸²è¡Œç«¯å£ï¼Œéœ€è¦å°†å®¹å™¨æ·»åŠ åˆ°`dialout`ç»„ä¸­

```shell
docker run -it -p 1880:1880 -v node_red_data:/data --group-add dialout --name mynodered nodered/node-red
```

ä»å®¹å™¨å†…çš„ä¸»æœºè®¿é—®è®¾å¤‡ï¼Œä¾‹å¦‚ä¸²è¡Œç«¯å£ï¼Œä½¿ç”¨ `--device` æ¥ä¼ é€’è®¿é—®æƒé™ã€‚

```shell
docker run -it -p 1880:1880 -v node_red_data:/data --name mynodered --device=/dev/ttyACM0 nodered/node-red
```

## Node-RED å¼€å‘æ‰‹å†Œ

## flowç¤ºä¾‹

- mqtt
- http
- websockets
- csv
- python

## ä¸‹ä¸€æ­¥

- [äº†è§£å¦‚ä½•ä¿æŠ¤æ‚¨çš„ç¼–è¾‘å™¨](https://nodered.org/docs/user-guide/runtime/securing-node-red)ï¼šå¦‚ä½•ä¿æŠ¤ Node-RED

